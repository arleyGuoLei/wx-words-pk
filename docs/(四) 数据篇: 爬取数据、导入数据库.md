# (å››) æ•°æ®ç¯‡: çˆ¬å–æ•°æ®ã€å¯¼å…¥æ•°æ®åº“

è¦è·å¾—APPçš„åŸºç¡€æ•°æ®ï¼Œä¸€èˆ¬é€”å¾„æœ‰æ‰¾åˆ°åˆ«äººå¼€æºçš„æ•°æ®æˆ–è‡ªå·±åˆ°å…¶ä»–ç½‘ç«™ã€APPçˆ¬å–æ•°æ®ï¼Œå¯¹äºçˆ¬è™«ï¼ŒæŠ“åŒ…ä¹Ÿå°±æˆä¸ºäº†æœ€åŸºæœ¬çš„èƒ½åŠ›ï¼Œæœ¬ç¯‡ç”¨äºåˆ†äº«ä¸€äº›æŠ“åŒ…çŸ¥è¯†åŠé»‘ç§‘æŠ€åˆ†äº«

## æŠ“åŒ…è½¯ä»¶

- Windowsç«¯ / APPï¼šå¯¹äºWindowsç³»ç»Ÿç«¯ç”¨æˆ·æƒ³è¦æŠ“APPæˆ–æœ¬åœ°å®¢æˆ·ç«¯çš„åŒ…ï¼Œæ¨èä½¿ç”¨[fiddler](www.telerik.com/fiddler)ï¼Œæœ¬ç¯‡ä¸åšä»‹ç»ï¼Œ[æ¨èæ•™ç¨‹](https://www.jianshu.com/p/724097741bdf)
- Macç«¯ / APPï¼šå¯¹äºè‹¹æœç³»ç»Ÿç«¯ç”¨æˆ·æƒ³è¦æŠ“APPæˆ–æœ¬åœ°å®¢æˆ·ç«¯çš„åŒ…ï¼Œæ¨èä½¿ç”¨[Charles](https://www.charlesproxy.com/)ï¼Œæœ¬æ–‡å®æˆ˜ä¸­ä½¿ç”¨çš„ä¹Ÿæ˜¯è¿™æ¬¾è½¯ä»¶
- Webç«¯ç½‘ç«™ï¼šå¯¹äºæµè§ˆå™¨ç«¯çš„è¯ï¼Œç›´æ¥ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·å°±è¡Œï¼Œæ¨èä½¿ç”¨è°·æ­Œæµè§ˆå™¨
- å®‰å“æ‰‹æœºç«¯ï¼šæ¨èä½¿ç”¨[httpCanary](https://www.52pojie.cn/thread-946430-1-1.html)ï¼Œç®€å•çš„æŠ“åŒ…è¿˜æ˜¯å¯ä»¥æ»¡è¶³çš„äº†

## æŠ“åŒ…å®æˆ˜

å•è¯å¤©å¤©æ–—å°ç¨‹åºä¸­ï¼Œéœ€è¦ç”¨åˆ°çš„æœ€åŸºç¡€æ•°æ®ä¸ºå•è¯ï¼Œæ‰€ä»¥æœ¬ç¯‡å®æˆ˜å¸¦å¤§å®¶æ‹¿ä¸‹å•è¯æ•°æ®å¹¶ä»£ç å®ç°

### CharlesåŠæ‰‹æœºé…ç½®

- è¯¦ç»†æ•™ç¨‹å¯é˜…è¯»[å²ä¸Šæœ€å¼º Charles æŠ“åŒ…](https://juejin.im/post/5b4f005ae51d45191c7e534a)

- ç”µè„‘å’Œæ‰‹æœºåœ¨åŒä¸€å±€åŸŸç½‘ä¹‹åï¼ŒPCç«¯é…ç½®ä»£ç†ç«¯å£ï¼ŒæŸ¥è¯¢å±€åŸŸç½‘IPåœ°å€
- æ‰‹æœºç«¯è®¾ç½®æ‰‹åŠ¨ä»£ç†ï¼Œä»£ç†åœ°å€å¡«å†™PCç«¯åœ°å€ï¼Œç«¯å£å¡«å†™ä»£ç†ç«¯å£

1. ç«¯å£é…ç½®å…¥å£
![ç«¯å£é…ç½®å…¥å£](https://user-gold-cdn.xitu.io/2020/4/22/171a0eaacead3c2d?w=726&h=750&f=png&s=447809)

2. ç«¯å£é…ç½®

![ç«¯å£é…ç½®](https://user-gold-cdn.xitu.io/2020/4/22/171a0eb27c7255cc?w=1440&h=1048&f=png&s=287539)

3. ç”µè„‘IPæŸ¥è¯¢(ifconfig)

![æŸ¥è¯¢å±€åŸŸç½‘IP](https://user-gold-cdn.xitu.io/2020/4/22/171a0ec5a464ccf5?w=1160&h=128&f=png&s=163198)

4. æ‰‹æœºç«¯è®¾ç½®IPä»£ç†

![æ‰‹æœºç«¯è®¾ç½®IPä»£ç†](https://user-gold-cdn.xitu.io/2020/4/22/171a0eccc8828e3b?w=1080&h=2340&f=jpeg&s=244135)

### å¼€å§‹æŠ“åŒ…

ç”µè„‘ç«¯å’Œæ‰‹æœºç«¯éƒ½æŒ‰ç…§æ–‡ç« ä¸­æçš„é…ç½®å¥½ä¹‹åï¼Œå°±å¯ä»¥æ‰¾APPå‡†å¤‡"å­¦ä¹ "ä¸€ç•ªäº†ï¼Œæ–‡ä¸­ä»¥ã€Œyou dao bei dan ciã€ä¸ºä¾‹

å¼€å¯æŠ“åŒ…ï¼Œæ‰“å¼€APPï¼Œé¦–é¡µç‚¹å‡»[æ¢æœ¬ä¹¦èƒŒ]è¿›å…¥å•è¯ä¹¦é€‰æ‹©é¡µé¢ï¼Œå°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„åŒ…äº†ã€‚

1. åŒ…åˆ†æ

å…¶ä¸­`offlinedata`å­—æ®µä¹Ÿå°±æ˜¯ç¦»çº¿å•è¯ä¹¦çš„æ•°æ®ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠæ‰€æœ‰ç¦»çº¿å•è¯ä¹¦æ•°æ®æ‹¿ä¸‹æ¥ä¹‹åï¼Œåœ¨åšæ•°æ®æ•´ç†

![å•è¯ä¹¦åŒ…](https://user-gold-cdn.xitu.io/2020/4/22/171a0f3c0340b0eb?w=3584&h=2240&f=png&s=624690)

å›¾ä¸­è¿˜å¯ä»¥çœ‹åˆ°è¯·æ±‚å‚æ•°æœ‰`bookIds`å’Œ`reciteType`ï¼ŒbookIdsçš„æ•°æ®å¯ä»¥ä»å›¾ä¸Šçš„å…¶ä¸­ä¸€ä¸ªæ¥å£è·å–

ç„¶åå®‰åˆ©ç¬¬ä¸€ä¸ªç½‘ç«™

- [apizza](https://apizza.net/pro/#/)ï¼šæ¥å£æµ‹è¯•å·¥å…·ï¼Œç±»ä¼¼çš„è¿˜æœ‰postmanä¹‹ç±»çš„ï¼Œæœ¬ç½‘ç«™ä¼˜åŠ¿åœ¨äºä¸éœ€è¦ä¸‹è½½appï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆä»£ç 

æˆ‘ä»¬å°†ä¸¤ä¸ªæ¥å£çš„`è¯·æ±‚å¤´`å’Œ`è¯·æ±‚ä½“`éƒ½å¤åˆ¶åˆ°apizzaçš„é¡¹ç›®ä¸­åšæµ‹è¯•

![apizza](https://user-gold-cdn.xitu.io/2020/4/22/171a0fe13e97d368?w=3582&h=1898&f=png&s=503914)

å›¾ä¸­çš„ä¹Ÿå°±æ˜¯`bookIds`å‚æ•°ï¼Œç„¶åæµ‹è¯•è·å–ç¦»çº¿å•è¯ä¹¦æ•°æ®çš„æ¥å£

![ç¦»çº¿å•è¯ä¹¦](https://user-gold-cdn.xitu.io/2020/4/22/171a0fffddaec84a?w=3566&h=1972&f=png&s=565061)

è‡³æ­¤ï¼Œå·²ç»æ‹¿åˆ°äº†æ‰€æœ‰çš„å•è¯ä¹¦æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»£ç æŠŠæ‰€æœ‰å•è¯ä¹¦ä¸‹è½½

### Coding

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`apizza`è‡ªå¸¦çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå…ˆç”Ÿæˆæœ€åŸºç¡€çš„è¯·æ±‚ä»£ç ï¼Œååºä»£ç å†ç¨ä½œä¿®æ”¹å³å¯

![ç”Ÿæˆä»£ç ](https://user-gold-cdn.xitu.io/2020/4/22/171a102f27d8ecb1?w=3552&h=1894&f=png&s=623891)

1. ä¸‹æ–¹ä¸ºè‡ªåŠ¨ç”Ÿæˆçš„ä»£ç 

```js
var request = require("request");

var options = {
  method: 'POST',
  url: 'http://reciteword.[ NOT KONW ].com/reciteword/v1/getBooksInfo',
  qs: {
    keyfrom: 'reciteword.1.5.12.android',
    vendor: 'xiaomi',
    mid: '9',
    imei: 'CQ',
    screen: '1080x1920',
    model: 'Mi_Note_3',
    version: '1.5.12'
  },
  headers: {
    'cache-control': 'no-cache',
    'content-type': 'multipart/form-data; boundary=---011000010111000001101001'
  },
  formData: {
    bookIds: '["CET4luan_1","CET6luan_1","KaoYanluan_1","Level4luan_1","Level8_1","CET4luan_2","CET6_2","KaoYan_2","Level4luan_2","Level8luan_2","IELTSluan_2","TOEFL_2","GRE_2","SAT_2","GMATluan_2","ChuZhongluan_2","GaoZhongluan_2","PEPXiaoXue3_1","PEPXiaoXue3_2","PEPXiaoXue4_1","PEPXiaoXue4_2","PEPXiaoXue5_1","PEPXiaoXue5_2","PEPXiaoXue6_1","PEPXiaoXue6_2","PEPChuZhong7_1","PEPChuZhong7_2","PEPChuZhong8_1","PEPChuZhong8_2","PEPChuZhong9_1","WaiYanSheChuZhong_1","WaiYanSheChuZhong_2","WaiYanSheChuZhong_3","WaiYanSheChuZhong_4","WaiYanSheChuZhong_5","WaiYanSheChuZhong_6","PEPGaoZhong_1","PEPGaoZhong_2","PEPGaoZhong_3","PEPGaoZhong_4","PEPGaoZhong_5","PEPGaoZhong_6","PEPGaoZhong_7","PEPGaoZhong_8","PEPGaoZhong_9","PEPGaoZhong_10","PEPGaoZhong_11","BEC_2","BeiShiGaoZhong_1","BeiShiGaoZhong_2","BeiShiGaoZhong_3","BeiShiGaoZhong_4","BeiShiGaoZhong_5","BeiShiGaoZhong_6","BeiShiGaoZhong_7","BeiShiGaoZhong_8","BeiShiGaoZhong_9","BeiShiGaoZhong_10","BeiShiGaoZhong_11"]',
    reciteType: 'normal'
  }
};

request(options, function (error, response, body) {
  if (error) throw new Error(error);

  console.log(body);
});

```

2. å®Œå–„ä»£ç 

NodeJSç‰ˆæœ¬çš„ä»£ç æ‰¾ä¸åˆ°äº†... æ”¾Pythonå†™çš„

pythonç‰ˆæœ¬ï¼š

```python
import requests
import json
import zipfile
import os

path = os.getcwd()

def getBooksId():
    url = "http://reciteword.[not konw].com/reciteword/v1/param?key=normalBooks&keyfrom=reciteword.1.5.12.android&vendor=xiaomi&mid=9&imei=CQ&screen=1080x1920&model=Mi_Note_3&version=1.5.12"
    bookList = json.loads(requests.get(url).text)["data"]["normalBooks"]["bookList"]
    BooksId = []
    for book in bookList:
        BooksId.append(book["id"])
    return BooksId

def getBooksDownLink(booksId):
    url = "http://reciteword.[not konw].com/reciteword/v1/getBooksInfo?keyfrom=reciteword.1.5.12.android&vendor=xiaomi&mid=9&imei=CQ&screen=1080x1920&model=Mi_Note_3&version=1.5.12"
    payload = {'bookIds': json.dumps(booksId), 'reciteType': 'normal'}
    booksInfo = json.loads(requests.post(url, data = payload).text)["data"]["normalBooksInfo"]
    downlink = []
    for book in booksInfo:
        downlink.append({"title": book["title"], "link": book["offlinedata"]})
    return downlink

def downBook(fileName, link):
    r = requests.get(link, stream=True)
    linkname = link[link.find(".com/") + 5:]
    with open(linkname, 'wb') as fd:
            fd.write(r.content)
    try:
        zipfileName = path + "/" + linkname
        print(zipfileName)
        file = zipfile.ZipFile(zipfileName)
        file.extractall(fileName)
        file.close()
    except Exception as e:
        print(e)

def main():
    BooksId = getBooksId()
    print(BooksId)
    downlink = getBooksDownLink(BooksId)
    print(downlink)

    for book in downlink:
        downBook(book["title"], book["link"])

if __name__ == '__main__':
    main()
```

### æ•°æ®æ•´ç†åŠå…¥åº“

æ‹¿åˆ°æ‰€æœ‰æ•°æ®åï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨å¾—åˆ°çš„å­—æ®µï¼Œæ•´ç†ä¿å­˜è‡³`MongoDB`æ•°æ®åº“

![ç›®å½•](https://user-gold-cdn.xitu.io/2020/4/22/171a111754723428?w=3582&h=2120&f=png&s=2076180)

```json
<!-- ä¹‹å‰çš„æ ¼å¼ -->
{"wordRank":1,"headWord":"paragraph","content":{"word":{"wordHead":"paragraph","wordId":"KaoYan_2_1","content":{"sentence":{"sentences":[{"sContent":"the opening paragraphs of the novel","sCn":"å°è¯´å¼€ç¯‡çš„å‡ ä¸ªæ®µè½"}],"desc":"ä¾‹å¥"},"usphone":"'pÃ¦rÉ™É¡rÃ¦f","ukphone":"'pÃ¦rÉ™grÉ‘Ëf","ukspeech":"paragraph&type=1","star":0,"phrase":{"phrases":[{"pContent":"new paragraph","pCn":"å¦èµ·ä¸€è¡Œï¼Œæ–°æ®µè½"},{"pContent":"opening paragraph","pCn":"å¼€å§‹éƒ¨åˆ†"}],"desc":"çŸ­è¯­"},"phone":"'pÃ¦rÉ™É¡rÉ‘:f, -É¡rÃ¦f","speech":"paragraph","remMethod":{"val":" para(åœ¨æ—è¾¹)+graph(å†™)â†’å†™åœ¨æ–‡å­—æ—è¾¹â†’æ®µï¼› çŸ­è¯„","desc":"è®°å¿†"},"relWord":{"rels":[{"pos":"n","words":[{"hwd":"paragrapher","tran":" çŸ­è¯„è®°è€…"}]}],"desc":"åŒæ ¹"},"usspeech":"paragraph&type=2","trans":[{"tranCn":"æ®µè½ï¼›çŸ­è¯„ï¼›æ®µè½ç¬¦å·","descOther":"è‹±é‡Š","descCn":"ä¸­é‡Š","pos":"n","tranOther":"part of a piece of writing which starts on a new line and contains at least one sentence"},{"tranCn":"å°†â€¦åˆ†æ®µ","descCn":"ä¸­é‡Š","pos":"v"}]}}},"bookId":"KaoYan_2"}

<!-- æ‰€éœ€ç”¨åˆ°çš„æ ¼å¼ -->
{"rank":1,"word":"paragraph","bookId":"kaoYanFull","_id":"kaoYanFull_1","usphone":"'pÃ¦rÉ™É¡rÃ¦f","trans":[{"tranCn":"æ®µè½ï¼›çŸ­è¯„ï¼›æ®µè½ç¬¦å·","pos":"n"},{"tranCn":"å°†â€¦åˆ†æ®µ","pos":"v"}]}
```

```js
const fs = require('fs')
const path = require('path')

const file2Jsons = (p) => {
  const p1 = new Promise(resolve => {
    fs.readFile(p, 'utf-8', function(error, data) {
      if (error) return console.log('è¯»å–æ–‡ä»¶å¤±è´¥,å†…å®¹æ˜¯' + error.message)
      resolve(data.split('\r\n'))
    })
  })
  return p1
}

const kaoYan = {
  paths: [path.resolve(__dirname, './data/è€ƒç ”å¿…å¤‡/KaoYanluan_1.json')],
  bookName: 'kaoYan'
}
const CET4 = {
  paths: [path.resolve(__dirname, './data/å››çº§çœŸé¢˜æ ¸å¿ƒè¯ï¼ˆå›¾ç‰‡è®°å¿†ï¼‰/CET4luan_1.json')],
  bookName: 'CET4'
}
const CET6 = {
  paths: [path.resolve(__dirname, './data/å…­çº§çœŸé¢˜æ ¸å¿ƒè¯ï¼ˆå›¾ç‰‡è®°å¿†ï¼‰/CET6luan_1.json')],
  bookName: 'CET6'
}
const chuZhong = {
  paths: [path.resolve(__dirname, './data/ä¸­è€ƒå¿…å¤‡è¯æ±‡/ChuZhongluan_2.json')],
  bookName: 'middle'
}
const gaoZhong = {
  paths: [path.resolve(__dirname, './data/é«˜è€ƒå¿…å¤‡è¯æ±‡ï¼ˆå›¾ç‰‡è®°å¿†ï¼‰/GaoZhongluan_2.json')],
  bookName: 'high'
}
const xiaoXue = {
  paths: [
    path.resolve(__dirname, './data/äººæ•™ç‰ˆå°å­¦è‹±è¯­-ä¸‰å¹´çº§ä¸Šå†Œ/PEPXiaoXue3_1.json'),
    path.resolve(__dirname, './data/äººæ•™ç‰ˆå°å­¦è‹±è¯­-ä¸‰å¹´çº§ä¸‹å†Œ/PEPXiaoXue3_2.json'),
    path.resolve(__dirname, './data/äººæ•™ç‰ˆå°å­¦è‹±è¯­-å››å¹´çº§ä¸Šå†Œ/PEPXiaoXue4_1.json'),
    path.resolve(__dirname, './data/äººæ•™ç‰ˆå°å­¦è‹±è¯­-å››å¹´çº§ä¸‹å†Œ/PEPXiaoXue4_2.json'),
    path.resolve(__dirname, './data/äººæ•™ç‰ˆå°å­¦è‹±è¯­-äº”å¹´çº§ä¸Šå†Œ/PEPXiaoXue5_1.json'),
    path.resolve(__dirname, './data/äººæ•™ç‰ˆå°å­¦è‹±è¯­-äº”å¹´çº§ä¸‹å†Œ/PEPXiaoXue5_2.json')
  ],
  bookName: 'primary'
}

const kaoYanFull = {
  paths: [path.resolve(__dirname, './data/KaoYan_2.json')],
  bookName: 'kaoYanFull'
}

const CET4Full = {
  paths: [path.resolve(__dirname, './data/CET4luan_2.json')],
  bookName: 'CET4Full'
}

const CET6Full = {
  paths: [path.resolve(__dirname, './data/CET6_2.json')],
  bookName: 'CET6Full'
}

const IELTS = {
  paths: [path.resolve(__dirname, './data/é›…æ€è¯æ±‡.json')],
  bookName: 'IELTS'
}

const BEC = {
  paths: [path.resolve(__dirname, './data/å•†åŠ¡è‹±è¯­.json')],
  bookName: 'BEC'
}

async function Start(book) {
  let lines = []
  for (const p of book.paths) {
    const content = await file2Jsons(p)
    lines = lines.concat(content)
  }
  writeFile(lines, book)
}

const writeFile = (lines, { bookName }) => {
  const content = lines.map((line, index) => {
    try {
      if (line) {
        const obj = JSON.parse(line)
        const word = {
          rank: index + 1,
          word: obj.headWord,
          bookId: bookName,
          _id: `${bookName}_${index + 1}`,
          usphone: obj.content.word.content.usphone,
          trans: obj.content.word.content.trans.map(tran => {
            return {
              tranCn: tran.tranCn,
              pos: tran.pos
            }
          })
        }
        return JSON.stringify(word)
      }
    } catch (error) {
      console.error('log => : writeFile -> error', error)
    }
  })
  const res = content.join('\r\n')
  const file = `./db/${bookName}_${Date.now()}.json`
  fs.writeFile(path.resolve(__dirname, file), res, function(error) {
    if (error) {
      console.log('å†™å…¥å¤±è´¥')
    } else {
      console.log(`å†™å…¥${file}`)
    }
  })
}

Start(kaoYan)
Start(CET4)
Start(CET6)
Start(chuZhong)
Start(gaoZhong)
Start(xiaoXue)
Start(kaoYanFull)
Start(CET4Full)
Start(CET6Full)
Start(IELTS)
Start(BEC)
```

3. æ•°æ®å¯¼å…¥(å…¥åº“)

ç”±äºå¾®ä¿¡å°ç¨‹åºäº‘å¼€å‘ä¸æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ å¯¼å…¥ï¼Œæ‰€ä»¥åˆå¼€å‘äº†ä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å·¥å…·ï¼Œè¯¦æƒ…è§: [ä¸€èµ·æ’¸ã€å¾®ä¿¡å°ç¨‹åºäº‘å¼€å‘âœˆï¸ ã€‘æ•°æ®åº“æ‰¹é‡å¯¼å…¥ ğŸ”¥ğŸ”¥ğŸ”¥ @ electron-vue](https://juejin.im/post/5e2bf3e4f265da3e4244ea7f)

## å†™åœ¨æœ€å

- æœ¬ç¯‡ä»…ç”¨äºå­¦ä¹ ï¼Œè¯·ä¸è¦æ¶æ„æŠ“å–æ•°æ®ï¼Œå¦‚æœæ•™ç¨‹æœ‰ä¾µæƒï¼Œè”ç³»ä¾µåˆ 
- å¯¹äºçˆ¬è™«ï¼Œè¿˜éœ€è¦æœ‰ä¸€äº›åçˆ¬æªæ–½ï¼Œæ¯”å¦‚ipä»£ç†ç­‰
- å¯¹äºè¯·æ±‚åŒ…çš„ç»“æ„ï¼Œè¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰çš„è¯¦æƒ…ï¼Œå¯ä»¥æŸ¥é˜…[MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers)
